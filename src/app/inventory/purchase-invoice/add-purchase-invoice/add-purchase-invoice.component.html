<section class="content">
  <div class="content-block">
    <div class="block-header">
      <!-- breadcrumb -->
      <app-breadcrumb [title]="'Add Purchase Invoice'" [items]="['Inventory']" [active_item]="'Add Purchase Invoice'">
      </app-breadcrumb>
    </div>
    <div class="row clearfix ">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
      <div class="box-shadow">
        <div class="card">
          <div class="body">
            <form class="m-12" [formGroup]="docForm">
              <div class="row">
                <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 ">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Company Name</mat-label>
                        <input matInput formControlName="companyName" readonly>
                  </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12" >
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label>Party Invoice No</mat-label>
                      <input matInput formControlName="partyInvoiceNo">
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12" >
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label>Purchase Order No</mat-label>
                      <input matInput formControlName="purchaseOrderNo">
                    </mat-form-field>
                  </div>
                  </div>
                  <div class="row">
                  <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 ">
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label>Purchase Invoice Date</mat-label>
                      <input matInput [matDatepicker]="picker" formControlName="purchaseInvoiceDateObj"
                        (dateInput)="$event.value.format('DD/MM/YYYY')" id="purchaseInvoiceDate" 
                                               (dateChange)="getDateString($event, 'purchaseInvoiceDate',0)"> 
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </div>
             
                  <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 ">
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label>Party Invoice Date</mat-label>
                      <input matInput [matDatepicker]="picker1" formControlName="partyInvoiceDateObj"
                        (dateInput)="$event.value.format('DD/MM/YYYY')" id="partyInvoiceDate" 
                                               (dateChange)="getDateString($event, 'partyInvoiceDate',0)"> 
                      <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                      <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 ">
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label> Due Date</mat-label>
                      <input matInput [matDatepicker]="picker2" formControlName="dueDateObj"
                        (dateInput)="$event.value.format('DD/MM/YYYY')" id="dueDate" 
                                               (dateChange)="getDateString($event, 'dueDate',0)"> 
                      <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                      <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>
                  </div>
              </div>
              
              <div class="row">
                <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                       <mat-label>Vendor</mat-label>
                            <mat-select  formControlName = "customer" required >
                              <mat-option *ngFor="let title of vendorList" [value]="title.vendorCode"  >
                                {{title.vendorName}}
                              </mat-option>
                            </mat-select>
                            <mat-error *ngIf="docForm.get('customer').hasError('required')">
                              Vendor is required
                            </mat-error>
                    </mat-form-field>
                 </div>
                 <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Currency</mat-label>
                       <mat-select formControlName="currency" 
                       required>
                        <mat-option *ngFor ="let obj of currList; let i=index" [value]="obj.id">
                            {{obj.text}}
                        </mat-option>
                       </mat-select>
                      <mat-error *ngIf="docForm.get('currency').hasError('required')">
                        Currency is required
                      </mat-error>
                  </mat-form-field>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12" >
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Exchange Rate</mat-label>
                    <input matInput formControlName="exchangerate">
                  </mat-form-field>
                </div>
                
              </div>
            
              <div class="row">
       
                <div class="col-xl-4 col-lg-12 col-md-12 col-sm-12 ">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Narration</mat-label>
                  <input matInput formControlName="narration" >
                  </mat-form-field>
                </div> 
                <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Tc Amount</mat-label>
                    <input matInput formControlName="tcAmount" (keypress)="keyPressNumberDouble($event)"
                     required>
                    <mat-error *ngIf="docForm.get('amount').hasError('required')">
                      Amount is required
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Bc Amount(USD)</mat-label>
                    <input matInput formControlName="bcAmount" (keypress)="keyPressNumberDouble($event)" 
                     required>
                    <mat-error *ngIf="docForm.get('amount').hasError('required')">
                      Amount is required
                    </mat-error>
                  </mat-form-field>
                </div>
                <!-- <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>LPO No</mat-label>
                     <mat-select formControlName="lpoNo" required>
                      <mat-option *ngFor ="let obj of fetchLpoList; let i=index" [value]="obj.id">
                        {{obj.text}}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="docForm.get('lpoNo').hasError('required')">
                     LPO No is required
                    </mat-error>
                  </mat-form-field>
                </div> -->
              </div>
                <!-- <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12">
                      <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                        <mat-label>LPO No</mat-label>
                         <mat-select formControlName="lpoNo" required>
                          <mat-option *ngFor ="let obj of fetchLpoList; let i=index" [value]="obj.id">
                            {{obj.text}}
                          </mat-option>
                        </mat-select>
                        <mat-error *ngIf="docForm.get('lpoNo').hasError('required')">
                         LPO No is required
                        </mat-error>
                      </mat-form-field>
                    </div> -->
              <div class="row">
             
                <!-- <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12" *ngIf="edit">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Purchase Invoice No</mat-label>
                    <input matInput formControlName="purchaseInvoiceNo" readonly>
                  </mat-form-field>
                </div> -->
              <!-- <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                  <mat-label>Delivery Note No</mat-label>
                   <mat-select formControlName="deliveryNo" required>
                    <mat-option *ngFor ="let obj of DeliveryNoList; let i=index" [value]="obj.id" (click)="getRequisition(obj.id)"  >
                      {{obj.text}}
                    </mat-option>
                   </mat-select>
                  <mat-error *ngIf="docForm.get('deliveryNo').hasError('required')">
                    Delivery Note No is required
                  </mat-error>
                </mat-form-field>
              </div> -->
              <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12" *ngIf ="this.docForm.value.currency !='KSH'">
                <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                  <mat-label>Exchange Rate(KSH)</mat-label>
                  <input matInput formControlName="exchangeRateksh">
                </mat-form-field>
              </div>
            </div>
            
            <!-- <div class="row" *ngIf="edit">
              <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                  <mat-label>Purchase Invoice No</mat-label>
                  <input matInput formControlName="purchaseInvoiceNo" readonly>
                </mat-form-field>
              </div>
            </div> -->
            <br>
        
              <!-- <mat-tab-group>
              <mat-tab label="Item"> -->
                <div>
                  <table id="dt_basic"
                  class="table table-striped font-weight-bold "
                     role="grid">
                <thead class="">
                 <tr>
                 <!-- <th class="width_1 table-heading text-center" style="margin-left: 25px;
                 width: 11%; border-radius: 0.05rem;"><label
                   class="i-checks m-b-none"> <input type="checkbox"
                     ng-model="selectedAll"
                     ng-change="checkAllVendor()">
                     <i></i>
                 </label></th> -->
                 <th style="width: 1%;"></th>
                 <th
                   class="text-center table-heading padding-both-side-2 width_7" style="margin-left: 25px;
                   width: 12%; border-radius: 0.05rem;">Item</th>
                 <th
                   class="text-center table-heading padding-both-side-2 width_7" style="margin-left: 25px;
                   width: 12%; border-radius: 0.05rem;">UOM</th>
                   <th
                   class="text-center table-heading padding-both-side-2 width_7"  style="margin-left: 25px;
                   width: 12%;border-radius: 0.07rem;">Qty</th>
                 <th
                   class="text-center table-heading padding-both-side-2 width_7"  style="margin-left: 25px;
                   width: 12%;border-radius: 0.07rem;">Price</th>
               </tr>
                </thead>

                <ng-container *ngFor="let purchaseInvoiceDetailBean of docForm.get('purchaseInvoiceDetailBean')['controls']; let i = index">
                  <tbody [formGroup]="purchaseInvoiceDetailBean"> 
                  <tr>
                  <!-- <td class=" text-center">
                   <label
                   class="i-checks m-b-none"> <input type="checkbox"
                   ng-model="row.tableId"> 
                  </label></td> -->

                  <td class="padding-both-side-2">
                    <button mat-mini-fab color="warn" (click)="removeRow(-1)">
                      <mat-icon class="col-white">delete</mat-icon>
                    </button>
                    </td>
  
                  <td class="padding-both-side-2">
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label>Item</mat-label>
                      <mat-select name="itemId{{i}}" formControlName="itemId"  required>
                        <mat-option *ngFor ="let obj1 of itemList; let i=index"  [value]="obj1.id">
                              {{obj1.text}}
                            </mat-option>
                       </mat-select>
                    </mat-form-field>
                   </td>
                
                  <td class="padding-both-side-2">
                    <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                      <mat-label>UOM</mat-label> 
                      <mat-select name="uomid{{i}}" formControlName="uomid"  required>
                        <mat-option *ngFor ="let obj1 of uomList; let i=index"  [value]="obj1.id">
                              {{obj1.text}}
                            </mat-option>
                       </mat-select> 
                  </mat-form-field>
                  </td> 
                      
                <td class="padding-both-side-2">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Qty</mat-label>
                    <!-- <input matInput name="qty{{i}}" formControlName ="qty" (keypress)="keyPressNumberDouble($event)" (keyup)="keyPressQty($event.target.value)" > -->
                    <input matInput name="qty{{i}}" formControlName ="qty" maxlength="20" (keypress)="keyPressNumberDouble($event)">
                    <mat-error *ngIf="docForm.get('currency').hasError('required')">
                      Qty does not allowed highest value
                    </mat-error>
                  </mat-form-field>
                </td>
  
                <td class="padding-both-side-2">
                  <mat-form-field class="example-full-width form-control-sm" appearance="outline">
                    <mat-label>Price</mat-label>
                    <input matInput name="quotePrice{{i}}" maxlength="20" (keypress)="keyPressNumberDouble($event)" formControlName ="quotePrice" >
                  </mat-form-field>
                </td>
             </tr>
           </tbody>
           </ng-container>
           </table>
       </div>

         <div class="row">
           <div>
             <!-- <button mat-mini-fab color="warn" (click)="removeRow(-1)">
               <mat-icon class="col-white">delete</mat-icon>
             </button>&nbsp; -->
             <button mat-mini-fab color="primary" (click)="addRow()">
               <mat-icon class="col-white">add</mat-icon>
             </button>
       </div>
        </div>
              <!-- </mat-tab>
            </mat-tab-group> -->
              <br><br>
               
              <div class="row"> 
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <button  *ngIf="!edit"  (click) = "onSubmit()" class="btn-space" mat-raised-button
                  color="accent" style="margin-left: 36%;background-color: #34d034;">Submit</button>
                  <button *ngIf="edit" (click) = "update()" class="btn-space" mat-raised-button
                  style="margin-left: 38%; color: aliceblue; background-color: green;">Update</button>
                    <button color="primary" type="button" class="btn-space" (click)="reset()" mat-raised-button>Reset</button>
                    <button color="warn" type="button" class="btn-space" (click)="onCancel()" mat-raised-button>Cancel</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
</section>

